<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>European Drone & Air Incidents Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body { margin: 0; padding: 0; height: 100%; font-family: sans-serif; }
  #map { width: 100%; height: 100%; }

  /* Legend container */
  #map-legend {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 260px;
    background: rgba(255,255,255,0.95);
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.4);
    z-index: 1000;
    overflow: hidden;
    transition: max-height 0.3s ease;
    max-height: 40px;
  }

  #map-legend.expanded { max-height: 500px; }

  #legend-toggle {
    display: block;
    padding: 10px 14px;
    background: #0078A8;
    color: white;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    text-align: center;
  }

  #legend-content {
    padding: 10px 14px;
    overflow-y: auto;
    max-height: 450px;
  }

  #legend-content p {
    margin: 6px 0;
    font-size: 14px;
  }

  #legend-content img {
    vertical-align: middle;
    width: 22px;
    height: 22px;
    margin-right: 8px;
  }
</style>
</head>
<body>

<div id="map"></div>

<div id="map-legend">
  <div id="legend-toggle">Legend â¬‡</div>
  <div id="legend-content">
    <p><img src="icons/red_drone.png">Red Drone: High alert</p>
    <p><img src="icons/orange_drone.png">Orange Drone: Medium alert</p>
    <p><img src="icons/yellow_drone.png">Yellow Drone: Low alert</p>
    <p><img src="icons/green_drone.png">Green Drone: Observed</p>
    <p><img src="icons/red_jet.png">Red Jet: Airspace incursion</p>
    <p><img src="icons/orange_jet.png">Orange Jet: Medium alert</p>
    <p><img src="icons/yellow_jet.png">Yellow Jet: Low alert</p>
    <p><img src="icons/green_jet.png">Green Jet: Observed</p>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Initialize map
  const map = L.map('map').setView([54.5, 10], 5);

  // Add OSM tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Legend toggle
  const legend = document.getElementById('map-legend');
  document.getElementById('legend-toggle').addEventListener('click', () => {
    legend.classList.toggle('expanded');
    map.invalidateSize();
  });

  // Icon factory
  function createIcon(file) {
    return L.icon({
      iconUrl: `icons/${file}`,
      iconSize: [32, 32],
      iconAnchor: [18, 36],
      popupAnchor: [0, -30]
    });
  }

  // UAV Icons
  const droneRed = createIcon("red_drone.png");
  const droneOrange = createIcon("orange_drone.png");
  const droneYellow = createIcon("yellow_drone.png");
  const droneGreen = createIcon("green_drone.png");

  // Jet Icons
  const jetRed = createIcon("red_jet.png");
  const jetOrange = createIcon("orange_jet.png");
  const jetYellow = createIcon("yellow_jet.png");
  const jetGreen = createIcon("green_jet.png");

  // -----------------------
  // Add all your markers here
  // -----------------------

  // Example marker (replace with all markers from your script)
  L.marker([49.74390, 15.33811], { icon: droneYellow })
    .addTo(map)
    .bindPopup(`<b>Czech Republic ðŸ‡¨ðŸ‡¿</b><br>Drone sighting example`);

  L.marker([55.60913, 12.65098], { icon: droneOrange })
    .addTo(map)
    .bindPopup(`<b>Copenhagen Airport, Denmark ðŸ‡©ðŸ‡°</b><br>Drone sighting example`);

  L.marker([54.19488, 9.09282], { icon: droneYellow })
    .addTo(map)
    .bindPopup(`<b>Heide, Germany ðŸ‡©ðŸ‡ª</b><br>Drone sighting example`);

  // -----------------------
  // OPTIONAL: Adjust popup maxWidth dynamically with zoom
  // -----------------------
  function getPopupWidth(zoom) {
    if (zoom <= 5) return 200;
    if (zoom <= 7) return 300;
    if (zoom <= 9) return 420;
    return 550;
  }

  map.on('zoomend', function () {
    const zoom = map.getZoom();
    map.eachLayer(layer => {
      if (layer instanceof L.Marker && layer.getPopup()) {
        layer.getPopup().options.maxWidth = getPopupWidth(zoom);
      }
    });
  });
</script>

</body>
</html>
